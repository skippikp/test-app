(this["webpackJsonptest-app"]=this["webpackJsonptest-app"]||[]).push([[0],{124:function(e,t,n){},151:function(e,t,n){},152:function(e,t,n){},153:function(e,t,n){},154:function(e,t,n){},155:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(26),s=n.n(r),i=(n(124),n(14)),o=n(11),l=n(19),u=n.n(l),d=n(32),h=n(39),j=n(49),b=n.n(j),f=new function e(){var t=this;Object(h.a)(this,e),this._apiBase="https://dispex.org/api/vtest",this.getResource=function(){var e=Object(d.a)(u.a.mark((function e(n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("".concat(t._apiBase).concat(n));case 2:if(!((a=e.sent).status>=400)){e.next=5;break}throw new Error("Could not fetch ".concat(n,", received ").concat(a.status));case 5:return e.next=7,a;case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getStreets=Object(d.a)(u.a.mark((function e(){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/Request/streets");case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)}))),this.getHouses=function(){var e=Object(d.a)(u.a.mark((function e(n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/Request/houses/".concat(n));case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getFlats=function(){var e=Object(d.a)(u.a.mark((function e(n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/Request/house_flats/".concat(n));case 2:return a=e.sent,e.abrupt("return",a.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.postPerson=function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={method:"POST",headers:{"Content-Type":"text/json",accept:"text/plain"},data:t,url:"https://dispex.org/api/vtest/HousingStock/client"},e.next=3,b()(n);case 3:if(!((a=e.sent).status>=400)){e.next=6;break}throw new Error("Could not fetch ".concat(n.url,", received ").concat(a.status));case 6:return e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.getAllTenants=function(){var e=Object(d.a)(u.a.mark((function e(n){var a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getResource("/HousingStock/clients?addressId=".concat(n));case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.bindPerson=function(){var e=Object(d.a)(u.a.mark((function e(t,n){var a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={method:"PUT",headers:{"Content-Type":"text/json",accept:"*/*"},data:{AddressId:t,ClientId:n},url:"https://dispex.org/api/vtest/HousingStock/bind_client"},e.next=3,b()(a);case 3:if(!((c=e.sent).status>=400)){e.next=6;break}throw new Error("Could not fetch ".concat(a.url,", received ").concat(c.status));case 6:return e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),this.removePerson=function(){var e=Object(d.a)(u.a.mark((function e(n){var a,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="".concat(t._apiBase,"/HousingStock/bind_client/").concat(n),e.next=3,b.a.delete(a);case 3:if(!((c=e.sent).status>=400)){e.next=6;break}throw new Error("Could not fetch ".concat(a,", received ").concat(c.status));case 6:return e.abrupt("return",c);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},p=f,O=n(199),x=n(202),m=n(201),v=n(2),g=function(e){var t=e.onOpen,n=e.loading,c=e.options,r=e.onChange,s=e.renderOptions,o=e.label,l=e.value;return Object(v.jsx)(x.a,{id:"select-component",onOpen:t,value:l,onChange:function(e,t){r(t)},isOptionEqualToValue:function(e,t){return e.label===t||e.label===(null===t||void 0===t?void 0:t.label)},loading:n,options:c,sx:{width:300},renderOption:s||function(e,t){return Object(a.createElement)("li",Object(i.a)(Object(i.a)({},e),{},{key:t.id}),t.label)},renderInput:function(e){return Object(v.jsx)(m.a,Object(i.a)(Object(i.a)({},e),{},{label:o}))}})},S="SET_STREETS",E="SET_HOUSES",C="SET_FLATS",w="SET_SELECTED_FLAT",y="SET_SELECTED_STREET",k="SET_CLIENT_LIST",T="SET_SELECTED_HOUSE",H=function(e){return{type:k,clientList:e}},F=n(33),I=(n(151),n(212)),L=n(214),N=n(213),P=n(206),_=n(161),A=function(e){var t=e.name,n=e.phone,a=e.email,c=e.handleEdit,r=e.handleRemove;return Object(v.jsxs)(I.a,{sx:{minWidth:275,maxWidth:500,minHeight:200},children:[Object(v.jsxs)(N.a,{children:[Object(v.jsx)(_.a,{sx:{fontSize:20},color:"text.secondary",gutterBottom:!0,children:t}),Object(v.jsx)(_.a,{sx:{fontSize:20},color:"green",children:n}),Object(v.jsx)(_.a,{sx:{mb:1.5},color:"text.secondary",children:a})]}),Object(v.jsxs)(L.a,{children:[Object(v.jsx)(P.a,{size:"small",onClick:c,children:"\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c"}),Object(v.jsx)(P.a,{size:"small",onClick:r,children:"\u0423\u0434\u0430\u043b\u0438\u0442\u044c"})]})]})},R=n(208),B=n(210),q=n(209),z=n(198),D=function(e){var t=e.person,n=e.open,a=e.handleClose,c=e.handleChangeName,r=e.handleChangeEmail,s=e.handleSubmit;return Object(v.jsxs)(R.a,{open:n,onClose:a,children:[Object(v.jsx)(z.a,{children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0436\u0438\u043b\u044c\u0446\u0430"}),Object(v.jsxs)(q.a,{children:[Object(v.jsx)(m.a,{id:"outlined-name",label:"\u0418\u043c\u044f",sx:{m:1,width:"25ch"},onChange:c,value:t.Name}),Object(v.jsx)(m.a,{id:"outlined-basic",label:"Email",sx:{m:1,width:"25ch"},variant:"outlined",value:t.Email,onChange:r})]}),Object(v.jsxs)(B.a,{children:[Object(v.jsx)(P.a,{onClick:a,children:"Cancel"}),Object(v.jsx)(P.a,{onClick:function(){return s(t)},children:"\u0418\u0437\u043c\u0435\u043d\u0438\u0442\u044c"})]})]})},U={setClientList:H},W=Object(F.b)((function(e){return{selectedFlat:e.selectedFlat}}),U)((function(e){var t=e.name,n=e.phone,c=e.email,r=e.bindId,s=e.selectedFlat,l=e.setClientList,u={Id:0,Name:t,Phone:n,Email:c,BindId:0},d=Object(a.useState)(!1),h=Object(o.a)(d,2),j=h[0],b=h[1],f=Object(a.useState)(u),O=Object(o.a)(f,2),x=O[0],m=O[1];return Object(v.jsxs)("div",{className:"personInfo",children:[Object(v.jsx)(A,{name:t,phone:n,email:c,handleEdit:function(){b(!0),m(u)},handleRemove:function(){return e=r,void p.removePerson(e).then((function(){p.getAllTenants(s.id).then((function(e){""!==e.data?l(e.data):l([])}))}));var e}}),Object(v.jsx)(D,{person:x,open:j,handleClose:function(){b(!1),p.getAllTenants(s.id).then((function(e){l(e.data)}))},handleChangeName:function(e){m((function(t){return Object(i.a)(Object(i.a)({},t),{},{Name:e.target.value})}))},handleChangeEmail:function(e){m((function(t){return Object(i.a)(Object(i.a)({},t),{},{Email:e.target.value})}))},handleSubmit:function(e){p.postPerson(e).then((function(){p.getAllTenants(s.id).then((function(e){l(e.data)}))})),b(!1)}})]})})),J={setAllHouses:function(e){return{type:E,houses:e}},setAllFlats:function(e){return{type:C,flats:e}},setSelectedFlat:function(e){return{type:w,selectedFlat:e}},setClientList:H,setAllStreets:function(e){return{type:S,streets:e}},setSelectedStreet:function(e){return{type:y,selectedStreet:e}},setSelectedHouse:function(e){return{type:T,selectedHouse:e}}},M=Object(F.b)((function(e){var t=e.streets,n=e.houses,a=e.flats,c=e.selectedFlat,r=e.selectedStreet;return{streets:t,houses:n,flats:a,selectedFlat:c,clientList:e.clientList,selectedStreet:r,selectedHouse:e.selectedHouse}}),J)((function(e){var t=e.streets,n=e.houses,r=e.setAllHouses,s=e.flats,l=e.setAllFlats,u=e.selectedFlat,d=e.setSelectedFlat,h=e.clientList,j=e.setClientList,b=e.setAllStreets,f=e.setSelectedStreet,x=e.selectedStreet,m=e.setSelectedHouse,S=e.selectedHouse,E=Object(a.useState)(""),C=Object(o.a)(E,2),w=C[0],y=C[1],k=t.map((function(e){return{label:e.name,id:e.id}})),T=n.map((function(e){return{label:e.name,id:e.id}})),H=s.map((function(e){return{label:e.name,typeName:e.typeName,id:e.id}})),F=0===t.length,I=0===n.length,L=0===s.length;return Object(v.jsxs)("div",{className:"form",children:[Object(v.jsxs)(O.a,{direction:"row",spacing:2,children:[Object(v.jsx)(g,{onOpen:function(){p.getStreets().then((function(e){b(e)}))},loading:F,options:k,onChange:function(e){f(null===e?"":e.label),function(e){e&&p.getHouses(e.id).then((function(e){r(e)}))}(e),d(""),y(""),m(""),j([])},label:"\u0423\u043b\u0438\u0446\u0430"}),Object(v.jsx)(g,{loading:I,options:T,onChange:function(e){m(null===e?"":e.label),function(e){e&&p.getFlats(e.id).then((function(e){l(e)}))}(e),d(""),y(""),j([])},label:"\u0414\u043e\u043c",value:S}),Object(v.jsx)(g,{loading:L,options:H,onChange:function(e){if(null===e)return d(""),y(""),void j([]);var t;d(e),y(e.label),(t=e.id)&&p.getAllTenants(t).then((function(e){200===e.status?j(e.data):j([])}))},renderOptions:function(e,t){if("\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430"===t.typeName)return Object(a.createElement)("li",Object(i.a)(Object(i.a)({},e),{},{key:t.id}),t.label)},label:"\u041a\u0432\u0430\u0440\u0442\u0438\u0440\u0430",value:w})]}),u?Object(v.jsxs)(c.a.Fragment,{children:[Object(v.jsx)("h4",{style:{fontWeight:500,fontSize:20},children:"\u0416\u0438\u043b\u044c\u0446\u044b ".concat(x," ").concat(S," \u043a\u0432\u0430\u0440\u0442\u0438\u0440\u0430: ").concat(u.label," :")}),Object(v.jsx)("div",{className:"personInfo",children:h.map((function(e,t){var n=e.name,a=e.phone,c=e.email,r=e.bindId;return Object(v.jsx)(W,{bindId:r,name:n,phone:a,email:c},t)}))})]}):null]})})),V=(n(152),n(205)),$=(n(153),{setClientList:H}),G=Object(F.b)((function(e){return{selectedFlat:e.selectedFlat,selectedStreet:e.selectedStreet,selectedHouse:e.selectedHouse}}),$)((function(e){var t=e.selectedFlat,n=e.setClientList,c=e.selectedStreet,r=e.selectedHouse,s=Object(a.useState)(!1),l=Object(o.a)(s,2),u=l[0],d=l[1],h=Object(a.useState)({Id:0,Name:"",Phone:"",Email:"",BindId:0}),j=Object(o.a)(h,2),b=j[0],f=j[1],O=function(e,a){p.bindPerson(e,a).then((function(){p.getAllTenants(t.id).then((function(e){200===e.status?n(e.data):n([])}))}))},x=function(){d(!0)},g=function(){d(!1),f({Id:0,Name:"",Phone:"",Email:"",BindId:0}),p.getAllTenants(t.id).then((function(e){n(e.data)}))},S=function(e){return/^((8|\+7)[\- ]?)?(\(?\d{3,4}\)?[\- ]?)?[\d\- ]{5,10}$/.test(e)};return Object(v.jsxs)("div",{className:"person_modal",children:["\u0424\u0435\u0434\u044e\u043d\u0438\u043d\u0441\u043a\u043e\u0433\u043e"===c&&r.includes("30")?Object(v.jsx)(P.a,{variant:"outlined",onClick:x,disabled:!t,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0436\u0438\u043b\u044c\u0446\u0430"}):Object(v.jsx)(V.a,{title:"\u0412\u044b \u043c\u043e\u0436\u0435\u0442\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0436\u0438\u043b\u044c\u0446\u043e\u0432 \u0442\u043e\u043b\u044c\u043a\u043e \u0434\u043b\u044f \u0443\u043b\u0438\u0446\u044b \u0424\u0435\u0434\u044e\u043d\u0438\u043d\u0441\u043a\u043e\u0433\u043e 30, \u0434\u043b\u044f \u0432\u0441\u0435\u0445 \u043a\u043e\u0440\u043f\u0443\u0441\u043e\u0432",children:Object(v.jsx)("span",{children:Object(v.jsx)(P.a,{variant:"outlined",onClick:x,disabled:!0,children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0436\u0438\u043b\u044c\u0446\u0430"})})}),Object(v.jsxs)(R.a,{open:u,onClose:g,children:[Object(v.jsx)(z.a,{children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0436\u0438\u043b\u044c\u0446\u0430"}),Object(v.jsxs)(q.a,{children:[Object(v.jsx)(m.a,{id:"outlined-name",label:"\u0424.\u0418.\u041e",sx:{m:1,width:"25ch"},onChange:function(e){f((function(t){return Object(i.a)(Object(i.a)({},t),{},{Name:e.target.value})}))},value:b.Name}),Object(v.jsx)(m.a,{id:"outlined-basic",label:"\u0422\u0435\u043b\u0435\u0444\u043e\u043d",type:"tel",required:!0,pattern:"[0-9]{3}-[0-9]{3}-[0-9]{4}",variant:"outlined",sx:{m:1,width:"25ch"},error:!S(b.Phone),value:b.Phone,onChange:function(e){f((function(t){return Object(i.a)(Object(i.a)({},t),{},{Phone:e.target.value})}))}}),Object(v.jsx)(m.a,{id:"outlined-basic",label:"Email",variant:"outlined",sx:{m:1,width:"25ch"},value:b.Email,onChange:function(e){f((function(t){return Object(i.a)(Object(i.a)({},t),{},{Email:e.target.value})}))}})]}),Object(v.jsxs)(B.a,{children:[Object(v.jsx)(P.a,{onClick:g,children:"Cancel"}),Object(v.jsx)(P.a,{disabled:!b.Phone||!S(b.Phone),onClick:function(){return function(e){p.postPerson(e).then((function(e){O(t.id,e.data.id)})),f({Id:0,Name:"",Phone:"",Email:"",BindId:0}),d(!1)}(b)},children:"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c"})]})]})]})})),K=n(59),Q=n(96),X=n(93),Y=(n(154),function(e){Object(Q.a)(n,e);var t=Object(X.a)(n);function n(){var e;Object(h.a)(this,n);for(var a=arguments.length,c=new Array(a),r=0;r<a;r++)c[r]=arguments[r];return(e=t.call.apply(t,[this].concat(c))).state={hasError:!1},e}return Object(K.a)(n,[{key:"componentDidCatch",value:function(){this.setState({hasError:!0})}},{key:"render",value:function(){return this.state.hasError?Object(v.jsxs)("div",{className:"error",children:[Object(v.jsx)("h2",{children:"Sorry"}),Object(v.jsx)("h3",{children:"something goes wrong"})]}):this.props.children}}]),n}(c.a.Component)),Z=Y,ee=function(){return Object(v.jsx)("div",{className:"app",children:Object(v.jsxs)(Z,{children:[Object(v.jsx)(M,{}),Object(v.jsx)(G,{})]})})},te=n(94),ne={streets:[],houses:[],flats:[],selectedFlat:"",clientList:[],selectedStreet:"",selectedHouse:""},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ne,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case S:return Object(i.a)(Object(i.a)({},e),{},{streets:t.streets});case E:return Object(i.a)(Object(i.a)({},e),{},{houses:t.houses});case C:return Object(i.a)(Object(i.a)({},e),{},{flats:t.flats});case w:return Object(i.a)(Object(i.a)({},e),{},{selectedFlat:t.selectedFlat});case T:return Object(i.a)(Object(i.a)({},e),{},{selectedHouse:t.selectedHouse});case k:return Object(i.a)(Object(i.a)({},e),{},{clientList:t.clientList});case y:return Object(i.a)(Object(i.a)({},e),{},{selectedStreet:t.selectedStreet});default:return e}},ce=Object(te.a)(ae);s.a.render(Object(v.jsx)(c.a.StrictMode,{children:Object(v.jsx)(F.a,{store:ce,children:Object(v.jsx)(ee,{})})}),document.getElementById("root"))}},[[155,1,2]]]);
//# sourceMappingURL=main.15dabd9c.chunk.js.map